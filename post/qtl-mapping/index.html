<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Quantitative Trait Loci (QTL) Mapping | Husain&#39;s Blog</title>
<meta name="keywords" content="Bioinformatics" />
<meta name="description" content="BackgroundFood security is one of the main priorities in the National Development Plan. The availability of strategic food is highly relied as an effort to achieve food security. Strategic food can be defined as a food commodity that is related to the needs of most people. One example of a strategic food commodity according to the Indonesian Ministry of Agriculture is chili/pepper. Most of the time the farmers experience crop failure due to bacterial and fungal disease attacks on the roots and leaves.">
<meta name="author" content="Ahmad Husain Abdullah">
<link rel="canonical" href="http://ahmadhusain.in/post/qtl-mapping/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ade87ea3120e9a1c6cc946e04768c952fa699fdea531ca3a5b082b605b467f77.css" integrity="sha256-reh&#43;oxIOmhxsyUbgR2jJUvppn96lMco6WwgrYFtGf3c=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://ahmadhusain.in/img/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ahmadhusain.in/img/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ahmadhusain.in/img/favicon.png">
<link rel="apple-touch-icon" href="http://ahmadhusain.in/apple-touch-icon.png">
<link rel="mask-icon" href="http://ahmadhusain.in/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.82.0" />
<link rel="alternate" hreflang="en" href="http://ahmadhusain.in/post/qtl-mapping/" />
<meta property="og:title" content="Quantitative Trait Loci (QTL) Mapping" />
<meta property="og:description" content="BackgroundFood security is one of the main priorities in the National Development Plan. The availability of strategic food is highly relied as an effort to achieve food security. Strategic food can be defined as a food commodity that is related to the needs of most people. One example of a strategic food commodity according to the Indonesian Ministry of Agriculture is chili/pepper. Most of the time the farmers experience crop failure due to bacterial and fungal disease attacks on the roots and leaves." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://ahmadhusain.in/post/qtl-mapping/" />
<meta property="og:image" content="http://ahmadhusain.in/img/pepper.png" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-08-25T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2018-08-25T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://ahmadhusain.in/img/pepper.png" />
<meta name="twitter:title" content="Quantitative Trait Loci (QTL) Mapping"/>
<meta name="twitter:description" content="BackgroundFood security is one of the main priorities in the National Development Plan. The availability of strategic food is highly relied as an effort to achieve food security. Strategic food can be defined as a food commodity that is related to the needs of most people. One example of a strategic food commodity according to the Indonesian Ministry of Agriculture is chili/pepper. Most of the time the farmers experience crop failure due to bacterial and fungal disease attacks on the roots and leaves."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://ahmadhusain.in/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Quantitative Trait Loci (QTL) Mapping",
      "item": "http://ahmadhusain.in/post/qtl-mapping/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Quantitative Trait Loci (QTL) Mapping",
  "name": "Quantitative Trait Loci (QTL) Mapping",
  "description": "Background\rFood security is one of the main priorities in the National Development Plan. The availability of strategic food is highly relied as an effort to achieve food security. Strategic food can be defined as a food commodity that is related to the needs of most people. One example of a strategic food commodity according to the Indonesian Ministry of Agriculture is chili/pepper. Most of the time the farmers experience crop failure due to bacterial and fungal disease attacks on the roots and leaves.",
  "keywords": [
    "Bioinformatics"
  ],
  "articleBody": "\r\rBackground\rFood security is one of the main priorities in the National Development Plan. The availability of strategic food is highly relied as an effort to achieve food security. Strategic food can be defined as a food commodity that is related to the needs of most people. One example of a strategic food commodity according to the Indonesian Ministry of Agriculture is chili/pepper. Most of the time the farmers experience crop failure due to bacterial and fungal disease attacks on the roots and leaves. One of the dominant diseases that attack pepper plants is the fungus Phytophthora capsici.\nIt is necessary to conduct a study to determine the location of the genes that affect the susceptibility of Phytophthora capsici. Several research results have proven that the Quantitative Trait Locus analysis is successful in identifying traits in plants. Therefore, as a study material for improving the quality of pepper plants, using the available DNA sequence data, using the QTL method approach, we will identify the location of the genes that are significantly associated with Phytophthora capsici disease.\n\rQuantitative Trait Loci\rIn a nutshell, the QTL is an individual chromosome locus where there are genes responsible for variations in a trait such as large fruit, sweet taste, level of spiciness, curly hair etc. Most of the quantitative traits in individuals are controlled by a number of genes.\nTo find out complex genetic trait, firstly we need to utilize the wide genetic diversity of the observed individuals by looking at the genetic linkage map. High density genetic linkage maps (centiMorgan) serve as marker-based selection to speed up breeding programs and to detect characterization of loci controlling for individual quantitative traits.\n\rModelling\rlibrary(ASMap)\rlibrary(qtlcharts)\rlibrary(qtl)\rlibrary(ggplot2)\rlibrary(ggpubr)\rlibrary(ggdendro)\rlibrary(factoextra)\rlibrary(car)\rlibrary(car)\rlibrary(dplyr)\rdata \r# --Read the following data:\r# 296 individuals\r# 26 markers\r# 1 phenotypes\r# --Cross type: f2\rread.cross() is a function to read QTL data. genotypes defines a vector or string of genetic code. Based on data, code “a” means homozygous dominant (resistant to the viruses), code “h” for homozygous recessive (susceptible to the viruses).\nsummary(data)\r# F2 intercross\r# # No. individuals: 296 # # No. phenotypes: 1 # Percent phenotyped: 100 # # No. chromosomes: 1 # Autosomes: 5 # # Total markers: 26 # No. markers: 26 # Percent genotyped: 100 # Genotypes (%): aa:24.0 ab:48.4 bb:27.6 not bb:0.0 not aa:0.0\rThe phenotype data describes the scoring of the resistance of pepper plants to the virus. The scores made are in the range of 0 to 5. Pepper plants that are resistant to virus will be given a score of 0. While those that are very susceptible will be given a score of 5.\nQTL Mapping\rInterval Mapping is a popular approach to QTL analysis. Each sequence marker will be calculated with Logarithm of the Odds (LOD) value. LOD score is a statistical value used in genetic data to measure whether the 2 or more genes being observed tend to be located close to each other or not. A LOD score of 3 or more generally means that the 2 genes are located close together on the chromosome.\nThe simplest method in QTL mapping analysis is Marker Regression or commonly known as Analysis of Variance (ANAVA). But there are three drawbacks Marker Regression method for QTL mapping. First, it cannot differentiate between the predicted location of QTL and the influence of QTL. The location of the QTL is estimated only by looking at the markers with the largest LOD score, not by testing the hypothesis. The second, it cannot be recommended when there is missing in the markers data. And the last, when the markers are far apart, it will imply weakening of the evidence to detect QTL.\nInterval mapping is used as a solution to the three problems found in the analysis of variance or Marker Regression. Interval mapping is currently the most popular approach to QTL mapping. In interval mapping, each locus marker is considered one by one and then the LOD score is calculated to determine the actual QTL locus model made.\n# Marker regression method\rdata_mr % est.rf(maxit = 200, tol = 1e-8) %% scanone(method = \"mr\")\r# Harley-Knott Regression\rdata_hk % est.rf(maxit = 200, tol = 1e-8) %% calc.genoprob(step = 1, error.prob = 0.001, map.function = \"haldane\") %% scanone(method = \"hk\")\r# Multiple Imputation\rset.seed(120)\rdata_imp % est.rf(maxit = 200, tol = 1e-8) %% sim.geno(step = 1, error.prob = 0.001) %% scanone(method = \"imp\")\rdata_mr %% arrange(desc(lod)) %% head()\r# chr pos lod\r# MCA32 5 256.479 8.591757\r# MCA12 5 129.609 8.115671\r# PMMCB105 5 139.883 7.640826\r# MCA9 5 149.926 7.340591\r# PMMCB81 5 117.338 5.832687\r# PMMCB32 5 145.402 5.791428\rWhen executed, it will produce a data object with 2 classes, namely scanone and dataframe. The data frame consists of four columns of information name of marker, location of the chromosomes, position of the genetic map (cM), and LOD score using each method. For instance, we print the data_mr and Marka MCA32 obtained the highest LOD score compared to the others around to 8,592.\nplot(\rdata_imp,\rdata_hk,\rdata_mr,\rylab = \"LOD Score\",\rlty = c(1, 1, 2),\rcol = c(\"black\", \"blue\", \"red\"),\rlwd = 2.5,\rylim = c(0, 10)\r)\rlegend(\r\"topleft\",\rlegend = c(\"Multiple Imputation\",\r\"Harley-Knott Regression\", \"Extented HK\"),\rcol = c(\"black\", \"blue\", \"red\"),\rlty = c(1, 1, 2),\rcex = 0.7,\rlwd = 2,\rtitle = \"Metode\"\r)\r\rModel Selection\rIn model selection, there are two approaches, forward selection and backward elimination. Forward selection is the stage of selecting the model by ‘forward’ selecting the most significant markers one by one. This process will stop when there are more markers that are potentially significant to the phenotype. While backward elimination, is the stage of selecting the model by ‘backward’ removing the markers that have the least significant effect.\ndata_sim \rset.seed(1)\routsw \rSelection of the best model is determined by the highest penalized LOD value.\nsummary(outsw)\r# QTL object containing imputed genotypes, with 296 imputations. # # name chr pos n.gen\r# Q1 5@117.3 5 117.34 3\r# Q2 5@159.3 5 159.31 3\r# Q3 5@256.5 5 256.48 3\r# # Formula: y ~ Q1 + Q2 + Q3 + Q1:Q2 # # pLOD: 11.326\rFormula Model:\n\\[y \\sim Q1 + Q2 + Q3 + Q1:Q2 \\]\n\ry: Resistance phenotype score\r\\(Q_i\\): The i-th QTL marker\r\rafter obtaining significant variables, we will create a QTL object and re-model (retrain) it with fitqtl.\nchr \r# # fitqtl summary\r# # Method: multiple imputation # Model: normal phenotype\r# Number of observations : 296 # # Full model result\r# ---------------------------------- # Model formula: y ~ Q1 + Q2 + Q3 + Q1:Q2 # # df SS MS LOD %var Pvalue(Chi2) Pvalue(F)\r# Model 10 366.9595 36.695946 24.7971 32.00891 0 0\r# Error 285 779.4696 2.734981 # Total 295 1146.4291 # # # Drop one QTL at a time ANOVA table: # ---------------------------------- # df Type III SS LOD %var F value Pvalue(Chi2) Pvalue(F) # 5@117.3 6 206.85 15.13 18.043 12.605 0.000 1.30e-12 ***\r# 5@159.3 6 162.83 12.19 14.203 9.923 0.000 6.01e-10 ***\r# 5@256.5 2 31.92 2.58 2.784 5.836 0.003 0.00328 ** # 5@117.3:5@159.3 4 151.49 11.42 13.214 13.847 0.000 2.47e-10 ***\r# ---\r# Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\rWe will summarize the important information in the following table:\ntibble(\rVariabel = c(\"Q1\", \"Q2\", \"Q3\", \"Q1:Q2\"),\r`Kode Marka` = c(\"PMMCB81\", \"PMMCB34\", \"MCA32\", \"PMMCB81 : PMMCB34\"),\r`% Var` = c(18.25, 13.36, 2.79, 12.62)\r)\r# # A tibble: 4 x 3\r# Variabel `Kode Marka` `% Var`\r#   \r# 1 Q1 PMMCB81 18.2 # 2 Q2 PMMCB34 13.4 # 3 Q3 MCA32 2.79\r# 4 Q1:Q2 PMMCB81 : PMMCB34 12.6\rThe first and second columns describe the symbol of the QTL model and its name. The percentage variance column (% var) is an estimate of the phenotype variance described by the PMMCB81, PMMCB34, MCA32 markers, and the PMMCB81: PMMCB34 marker interactions. The total % var was 46.3%. This means that the ability of all markers in the model to explain the phenotype variance scores of resistance to phytophthora capsici bacteria is 46.3%, while the rest is explained by other markers outside the observation.\nThe visualization of the genetic map with a significant QTL model and the result of the multiple imputation method LOD score is presented in the figure below.\npar(mfrow=c(1,2))\rplot(\routsw,\rcol = \"red\",\rjustdots = F,\rshow.marker.names = F\r)\rplot(\rdata_imp$lod,\rdata_imp$pos,\rcol = \"red\",\rxlab = \"LOD\",\rylim = c(315, 0),\rlas = 1,\rylab = \"Map Position (cM)\",\rtype = \"l\",\rlwd = 3,\rmain = \"Interval Mapping\"\r)\rlegend(\r\"bottomright\",\rlegend = \"Multiple Imputation\",\rcol = \"red\",\rlty = 1,\rcex = 0.7,\rlwd = 2,\rtitle = \"Metode\",\rbty = \"n\"\r)\r\r\r",
  "wordCount" : "1562",
  "inLanguage": "en",
  "image":"http://ahmadhusain.in/img/pepper.png","datePublished": "2018-08-25T00:00:00Z",
  "dateModified": "2018-08-25T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Ahmad Husain Abdullah"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://ahmadhusain.in/post/qtl-mapping/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Husain's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://ahmadhusain.in/img/r-icon.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://ahmadhusain.in/" accesskey="h" title="Husain&#39;s Blog (Alt + H)">Husain&#39;s Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://ahmadhusain.in/id/" title="Indonesian"
                            aria-label="Indonesian">Indonesian</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="http://ahmadhusain.in/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://ahmadhusain.in/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://ahmadhusain.in/">Home</a>&nbsp;»&nbsp;<a href="http://ahmadhusain.in/post/">Posts</a></div>
    <h1 class="post-title">
      Quantitative Trait Loci (QTL) Mapping
    </h1>
    <div class="post-meta">August 25, 2018&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Ahmad Husain Abdullah
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="http://ahmadhusain.in/img/pepper.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#" aria-label="Background">Background</a></li>
                <li>
                    <a href="#" aria-label="Quantitative Trait Loci">Quantitative Trait Loci</a></li>
                <li>
                    <a href="#" aria-label="Modelling">Modelling</a><ul>
                        
                <li>
                    <a href="#" aria-label="QTL Mapping">QTL Mapping</a></li>
                <li>
                    <a href="#" aria-label="Model Selection">Model Selection</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
<script src="http://ahmadhusain.in/post/qtl-mapping/index_files/header-attrs/header-attrs.js"></script>


<div id="background" class="section level1">
<h1>Background</h1>
<p>Food security is one of the main priorities in the National Development Plan. The availability of strategic food is highly relied as an effort to achieve food security. Strategic food can be defined as a food commodity that is related to the needs of most people. One example of a strategic food commodity according to the Indonesian Ministry of Agriculture is chili/pepper. Most of the time the farmers experience crop failure due to bacterial and fungal disease attacks on the roots and leaves. One of the dominant diseases that attack pepper plants is the fungus <em>Phytophthora capsici</em>.</p>
<p>It is necessary to conduct a study to determine the location of the genes that affect the susceptibility of <em>Phytophthora capsici</em>. Several research results have proven that the <em>Quantitative Trait Locus</em> analysis is successful in identifying traits in plants. Therefore, as a study material for improving the quality of pepper plants, using the available DNA sequence data, using the QTL method approach, we will identify the location of the genes that are significantly associated with <em>Phytophthora capsici disease</em>.</p>
</div>
<div id="quantitative-trait-loci" class="section level1">
<h1>Quantitative Trait Loci</h1>
<p>In a nutshell, the QTL is an individual chromosome locus where there are genes responsible for variations in a trait such as large fruit, sweet taste, level of spiciness, curly hair etc. Most of the quantitative traits in individuals are controlled by a number of genes.</p>
<p>To find out complex genetic trait, firstly we need to utilize the wide genetic diversity of the observed individuals by looking at the genetic linkage map. High density genetic linkage maps (centiMorgan) serve as marker-based selection to speed up breeding programs and to detect characterization of loci controlling for individual quantitative traits.</p>
</div>
<div id="modelling" class="section level1">
<h1>Modelling</h1>
<pre class="r"><code>library(ASMap)
library(qtlcharts)
library(qtl)
library(ggplot2)
library(ggpubr)
library(ggdendro)
library(factoextra)
library(car)
library(car)
library(dplyr)</code></pre>
<pre class="r"><code>data &lt;- read.cross(
  format = &quot;csv&quot;, 
  file =&quot;http://bit.ly/dataqtl&quot;, 
  sep = &quot;;&quot;, 
  genotypes = c(&quot;a&quot;,&quot;h&quot;,&quot;b&quot;),
  alleles = c(&quot;a&quot;,&quot;b&quot;)
)</code></pre>
<pre><code>#&gt;  --Read the following data:
#&gt;   296  individuals
#&gt;   26  markers
#&gt;   1  phenotypes
#&gt;  --Cross type: f2</code></pre>
<p><code>read.cross()</code> is a function to read QTL data. <code>genotypes</code> defines a vector or string of genetic code. Based on data, code “a” means homozygous dominant (resistant to the viruses), code “h” for homozygous recessive (susceptible to the viruses).</p>
<pre class="r"><code>summary(data)</code></pre>
<pre><code>#&gt;     F2 intercross
#&gt; 
#&gt;     No. individuals:    296 
#&gt; 
#&gt;     No. phenotypes:     1 
#&gt;     Percent phenotyped: 100 
#&gt; 
#&gt;     No. chromosomes:    1 
#&gt;         Autosomes:      5 
#&gt; 
#&gt;     Total markers:      26 
#&gt;     No. markers:        26 
#&gt;     Percent genotyped:  100 
#&gt;     Genotypes (%):      aa:24.0  ab:48.4  bb:27.6  not bb:0.0  not aa:0.0</code></pre>
<p>The phenotype data describes the scoring of the resistance of pepper plants to the virus. The scores made are in the range of 0 to 5. Pepper plants that are resistant to virus will be given a score of 0. While those that are very susceptible will be given a score of 5.</p>
<div id="qtl-mapping" class="section level2">
<h2>QTL Mapping</h2>
<p>Interval Mapping is a popular approach to QTL analysis. Each sequence marker will be calculated with Logarithm of the Odds (LOD) value. LOD score is a statistical value used in genetic data to measure whether the 2 or more genes being observed tend to be located close to each other or not. A LOD score of 3 or more generally means that the 2 genes are located close together on the chromosome.</p>
<p>The simplest method in QTL mapping analysis is Marker Regression or commonly known as Analysis of Variance (ANAVA). But there are three drawbacks Marker Regression method for QTL mapping. First, it cannot differentiate between the predicted location of QTL and the influence of QTL. The location of the QTL is estimated only by looking at the markers with the largest LOD score, not by testing the hypothesis. The second, it cannot be recommended when there is missing in the markers data. And the last, when the markers are far apart, it will imply weakening of the evidence to detect QTL.</p>
<p>Interval mapping is used as a solution to the three problems found in the analysis of variance or Marker Regression. Interval mapping is currently the most popular approach to QTL mapping. In interval mapping, each locus marker is considered one by one and then the LOD score is calculated to determine the actual QTL locus model made.</p>
<pre class="r"><code># Marker regression method

data_mr &lt;- data %&gt;% 
  est.rf(maxit = 200, tol = 1e-8) %&gt;% 
  scanone(method = &quot;mr&quot;)

# Harley-Knott Regression

data_hk &lt;- data %&gt;% 
  est.rf(maxit = 200, tol = 1e-8) %&gt;% 
  calc.genoprob(step = 1, error.prob = 0.001, map.function = &quot;haldane&quot;) %&gt;% 
  scanone(method = &quot;hk&quot;)

# Multiple Imputation

set.seed(120)

data_imp &lt;- data %&gt;% 
  est.rf(maxit = 200, tol = 1e-8) %&gt;% 
  sim.geno(step = 1, error.prob = 0.001) %&gt;% 
  scanone(method = &quot;imp&quot;)</code></pre>
<pre class="r"><code>data_mr %&gt;% 
  arrange(desc(lod)) %&gt;% 
  head()</code></pre>
<pre><code>#&gt;          chr     pos      lod
#&gt; MCA32      5 256.479 8.591757
#&gt; MCA12      5 129.609 8.115671
#&gt; PMMCB105   5 139.883 7.640826
#&gt; MCA9       5 149.926 7.340591
#&gt; PMMCB81    5 117.338 5.832687
#&gt; PMMCB32    5 145.402 5.791428</code></pre>
<p>When executed, it will produce a data object with 2 classes, namely <code>scanone</code> and <code>dataframe</code>. The data frame consists of four columns of information name of marker, location of the chromosomes, position of the genetic map (cM), and LOD score using each method. For instance, we print the <code>data_mr</code> and Marka MCA32 obtained the highest LOD score compared to the others around to 8,592.</p>
<pre class="r"><code>plot(
  data_imp,
  data_hk,
  data_mr,
  ylab = &quot;LOD Score&quot;,
  lty = c(1, 1, 2),
  col = c(&quot;black&quot;, &quot;blue&quot;, &quot;red&quot;),
  lwd = 2.5,
  ylim = c(0, 10)
)
legend(
  &quot;topleft&quot;,
  legend = c(&quot;Multiple Imputation&quot;,
             &quot;Harley-Knott Regression&quot;, &quot;Extented HK&quot;),
  col = c(&quot;black&quot;, &quot;blue&quot;, &quot;red&quot;),
  lty = c(1, 1, 2),
  cex = 0.7,
  lwd = 2,
  title = &quot;Metode&quot;
)</code></pre>
<p><img src="http://ahmadhusain.in/post/qtl-mapping/index_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="model-selection" class="section level2">
<h2>Model Selection</h2>
<p>In model selection, there are two approaches, forward selection and backward elimination. Forward selection is the stage of selecting the model by ‘forward’ selecting the most significant markers one by one. This process will stop when there are more markers that are potentially significant to the phenotype. While backward elimination, is the stage of selecting the model by ‘backward’ removing the markers that have the least significant effect.</p>
<pre class="r"><code>data_sim &lt;- sim.geno(
  cross = data,
  step = 0,
  error.prob = 0.001,
  map.function = &quot;haldane&quot;, 
  n.draws = 296
)</code></pre>
<pre class="r"><code>set.seed(1)
outsw &lt;- stepwiseqtl(data_sim, verbose = TRUE, method = &quot;imp&quot;)
outsw</code></pre>
<p>Selection of the best model is determined by the highest penalized LOD value.</p>
<pre class="r"><code>summary(outsw)</code></pre>
<pre><code>#&gt;   QTL object containing imputed genotypes, with 296 imputations. 
#&gt; 
#&gt;       name chr    pos n.gen
#&gt; Q1 5@117.3   5 117.34     3
#&gt; Q2 5@159.3   5 159.31     3
#&gt; Q3 5@256.5   5 256.48     3
#&gt; 
#&gt;   Formula: y ~ Q1 + Q2 + Q3 + Q1:Q2 
#&gt; 
#&gt;   pLOD:  11.326</code></pre>
<p>Formula Model:</p>
<p><span class="math display">\[y \sim Q1 + Q2 + Q3 + Q1:Q2 \]</span></p>
<ul>
<li>y: Resistance phenotype score</li>
<li><span class="math inline">\(Q_i\)</span>: The i-th QTL marker</li>
</ul>
<p>after obtaining significant variables, we will create a QTL object and re-model (retrain) it with <code>fitqtl</code>.</p>
<pre class="r"><code>chr &lt;- c(5, 5, 5)
pos &lt;- c(117.34, 159.31, 256.48)
qtl &lt;- makeqtl(data_sim, chr, pos)
my.formula &lt;- y ~ Q1 + Q2 + Q3 + Q1:Q2
out.fitqtl &lt;- fitqtl(data_sim,
                     qtl = qtl,
                     formula = my.formula,
                     get.ests = F)
summary(out.fitqtl)</code></pre>
<pre><code>#&gt; 
#&gt;      fitqtl summary
#&gt; 
#&gt; Method: multiple imputation 
#&gt; Model:  normal phenotype
#&gt; Number of observations : 296 
#&gt; 
#&gt; Full model result
#&gt; ----------------------------------  
#&gt; Model formula: y ~ Q1 + Q2 + Q3 + Q1:Q2 
#&gt; 
#&gt;        df        SS        MS     LOD     %var Pvalue(Chi2) Pvalue(F)
#&gt; Model  10  366.9595 36.695946 24.7971 32.00891            0         0
#&gt; Error 285  779.4696  2.734981                                        
#&gt; Total 295 1146.4291                                                  
#&gt; 
#&gt; 
#&gt; Drop one QTL at a time ANOVA table: 
#&gt; ----------------------------------  
#&gt;                 df Type III SS   LOD   %var F value Pvalue(Chi2) Pvalue(F)    
#&gt; 5@117.3          6      206.85 15.13 18.043  12.605        0.000  1.30e-12 ***
#&gt; 5@159.3          6      162.83 12.19 14.203   9.923        0.000  6.01e-10 ***
#&gt; 5@256.5          2       31.92  2.58  2.784   5.836        0.003   0.00328 ** 
#&gt; 5@117.3:5@159.3  4      151.49 11.42 13.214  13.847        0.000  2.47e-10 ***
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We will summarize the important information in the following table:</p>
<pre class="r"><code>tibble(
  Variabel = c(&quot;Q1&quot;, &quot;Q2&quot;, &quot;Q3&quot;, &quot;Q1:Q2&quot;),
  `Kode Marka` = c(&quot;PMMCB81&quot;, &quot;PMMCB34&quot;, &quot;MCA32&quot;, &quot;PMMCB81 : PMMCB34&quot;),
  `% Var` = c(18.25, 13.36, 2.79, 12.62)
)</code></pre>
<pre><code>#&gt; # A tibble: 4 x 3
#&gt;   Variabel `Kode Marka`      `% Var`
#&gt;   &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
#&gt; 1 Q1       PMMCB81             18.2 
#&gt; 2 Q2       PMMCB34             13.4 
#&gt; 3 Q3       MCA32                2.79
#&gt; 4 Q1:Q2    PMMCB81 : PMMCB34   12.6</code></pre>
<p>The first and second columns describe the symbol of the QTL model and its name. The percentage variance column (% var) is an estimate of the phenotype variance described by the PMMCB81, PMMCB34, MCA32 markers, and the PMMCB81: PMMCB34 marker interactions. The total % var was 46.3%. This means that the ability of all markers in the model to explain the phenotype variance scores of resistance to <em>phytophthora capsici</em> bacteria is 46.3%, while the rest is explained by other markers outside the observation.</p>
<p>The visualization of the genetic map with a significant QTL model and the result of the multiple imputation method LOD score is presented in the figure below.</p>
<pre class="r"><code>par(mfrow=c(1,2))

plot(
  outsw,
  col = &quot;red&quot;,
  justdots = F,
  show.marker.names = F
)
plot(
  data_imp$lod,
  data_imp$pos,
  col = &quot;red&quot;,
  xlab = &quot;LOD&quot;,
  ylim = c(315, 0),
  las = 1,
  ylab = &quot;Map Position (cM)&quot;,
  type = &quot;l&quot;,
  lwd = 3,
  main = &quot;Interval Mapping&quot;
)
legend(
  &quot;bottomright&quot;,
  legend = &quot;Multiple Imputation&quot;,
  col = &quot;red&quot;,
  lty = 1,
  cex = 0.7,
  lwd = 2,
  title = &quot;Metode&quot;,
  bty = &quot;n&quot;
)</code></pre>
<p><img src="http://ahmadhusain.in/post/qtl-mapping/index_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://ahmadhusain.in/tags/bioinformatics/">Bioinformatics</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://ahmadhusain.in/post/2018-09-15-reproduce-economist-plot/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Reproduce Economist Plot</span>
  </a>
</nav>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Quantitative Trait Loci (QTL) Mapping on twitter"
        href="https://twitter.com/intent/tweet/?text=Quantitative%20Trait%20Loci%20%28QTL%29%20Mapping&amp;url=http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f&amp;hashtags=Bioinformatics">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Quantitative Trait Loci (QTL) Mapping on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f&amp;title=Quantitative%20Trait%20Loci%20%28QTL%29%20Mapping&amp;summary=Quantitative%20Trait%20Loci%20%28QTL%29%20Mapping&amp;source=http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Quantitative Trait Loci (QTL) Mapping on reddit"
        href="https://reddit.com/submit?url=http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f&title=Quantitative%20Trait%20Loci%20%28QTL%29%20Mapping">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Quantitative Trait Loci (QTL) Mapping on facebook"
        href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Quantitative Trait Loci (QTL) Mapping on whatsapp"
        href="https://api.whatsapp.com/send?text=Quantitative%20Trait%20Loci%20%28QTL%29%20Mapping%20-%20http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Quantitative Trait Loci (QTL) Mapping on telegram"
        href="https://telegram.me/share/url?text=Quantitative%20Trait%20Loci%20%28QTL%29%20Mapping&amp;url=http%3a%2f%2fahmadhusain.in%2fpost%2fqtl-mapping%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="http://ahmadhusain.in/">Husain&#39;s Blog</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        container.appendChild(copybutton);
    });
</script>
</body>

</html>
